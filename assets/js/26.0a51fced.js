(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{524:function(r,s,e){"use strict";e.r(s);var t=e(26),a=Object(t.a)({},(function(){var r=this,s=r.$createElement,e=r._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":r.$parent.slotKey}},[e("h1",{attrs:{id:"sftp-不允许-ssh-登录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sftp-不允许-ssh-登录"}},[r._v("#")]),r._v(" sftp 不允许 ssh 登录")]),r._v(" "),e("h2",{attrs:{id:"一-准备环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-准备环境"}},[r._v("#")]),r._v(" 一. 准备环境")]),r._v(" "),e("p",[r._v("CentOS-6.5-x86_64-minimal")]),r._v(" "),e("h2",{attrs:{id:"二-约定"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-约定"}},[r._v("#")]),r._v(" 二. 约定")]),r._v(" "),e("p",[r._v("用户组：sftpGroup"),e("br"),r._v("\nsftpGroup 的用户：user1、user2"),e("br"),r._v("\n用户 user1 的目录限定为/var/noveltv/media/user1dir"),e("br"),r._v("\n用户 user2 的目录限定为/var/ntv/media/user2dir"),e("br"),r._v("\n用户 user1 密码：user1pwd"),e("br"),r._v("\n用户 user2 密码：user2pwd")]),r._v(" "),e("h2",{attrs:{id:"三-配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三-配置"}},[r._v("#")]),r._v(" 三. 配置")]),r._v(" "),e("ol",[e("li",[r._v("初始化第 1 个用户\ngroupadd sftpGroup"),e("br"),r._v("\nuseradd -M -G sftpGroup -s /sbin/nologin user1"),e("br"),r._v("\necho user1:user1pwd | chpasswd"),e("br"),r._v("\nvi /etc/ssh/sshd_config")])]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[r._v("#Subsystem sftp /usr/libexec/openssh/sftp-server\nSubsystem sftp internal-sftp\nMatch Group sftpGroup\nX11Forwarding no\nAllowTcpForwarding no\nChrootDirectory %h\nForceCommand internal-sftp\n")])])]),e("p",[r._v("service sshd restart"),e("br"),r._v("\nmkdir -p /var/noveltv/media/user1dir"),e("br"),r._v("\nusermod -d /var/noveltv/media/user1dir user1"),e("br"),r._v("\nchmod 755 /var/noveltv/media/user1dir"),e("br"),r._v("\nchown root /var/noveltv/media/user1dir"),e("br"),r._v("\nchgrp -R sftpGroup /var/noveltv/media/user1dir"),e("br"),r._v("\nmkdir /var/noveltv/media/user1dir/uploadFiles"),e("br"),r._v("\nchown user1. /var/noveltv/media/user1dir/uploadFiles/"),e("br"),r._v("\nsetsebool ssh_chroot_full_access on")]),r._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[r._v("添加剩余用户\nuseradd -M -G sftpGroup -s /sbin/nologin user2"),e("br"),r._v("\necho user2:user2pwd | chpasswd"),e("br"),r._v("\nmkdir -p /var/ntv/media/user2dir"),e("br"),r._v("\nusermod -d /var/ntv/media/user2dir user2"),e("br"),r._v("\nchmod 755 /var/ntv/media/user2dir"),e("br"),r._v("\nchown root /var/ntv/media/user2dir"),e("br"),r._v("\nchgrp sftpGroup /var/ntv/media/user2dir"),e("br"),r._v("\nmkdir /var/ntv/media/user2dir/uploadFiles"),e("br"),r._v("\nchown user2. /var/ntv/media/user2dir/uploadFiles/")])]),r._v(" "),e("h2",{attrs:{id:"四-验证"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四-验证"}},[r._v("#")]),r._v(" 四. 验证")]),r._v(" "),e("h3",{attrs:{id:"_1-验证-ssh-登录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-验证-ssh-登录"}},[r._v("#")]),r._v(" 1. 验证 ssh 登录")]),r._v(" "),e("p",[r._v("执行命令：ssh user1@localhost。若登录失败，则验证通过。"),e("br"),r._v(" "),e("img",{attrs:{src:"https://gitee.com/wangshibiao/blog_picBed2/raw/master/images/20200724141010.png",alt:""}})]),r._v(" "),e("h3",{attrs:{id:"_2-验证-sftp-登录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-验证-sftp-登录"}},[r._v("#")]),r._v(" 2. 验证 sftp 登录")]),r._v(" "),e("p",[r._v("登录后的窗口界面如下"),e("br"),r._v(" "),e("img",{attrs:{src:"https://gitee.com/wangshibiao/blog_picBed2/raw/master/images/20200724141039.png",alt:""}})]),r._v(" "),e("p",[e("strong",[r._v("注")]),r._v("："),e("br"),r._v("\n用户根目录无权限读写，uploadFiles 目录可读写。因此，文件需上传到 uploadFiles 目录中。")])])}),[],!1,null,null,null);s.default=a.exports}}]);