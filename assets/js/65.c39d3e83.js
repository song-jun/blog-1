(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{610:function(r,s,e){"use strict";e.r(s);var t=e(26),a=Object(t.a)({},(function(){var r=this,s=r.$createElement,e=r._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":r.$parent.slotKey}},[e("p"),e("div",{staticClass:"table-of-contents"},[e("ul",[e("li",[e("a",{attrs:{href:"#_1-约定"}},[r._v("1. 约定")])]),e("li",[e("a",{attrs:{href:"#_2-安装"}},[r._v("2. 安装")]),e("ul",[e("li",[e("a",{attrs:{href:"#_2-1-编译安装单机版-redis"}},[r._v("2.1 编译安装单机版 redis")])]),e("li",[e("a",{attrs:{href:"#_2-2-准备集群目录"}},[r._v("2.2 准备集群目录")])]),e("li",[e("a",{attrs:{href:"#_2-3-准备集群可执行文件"}},[r._v("2.3 准备集群可执行文件")])]),e("li",[e("a",{attrs:{href:"#_2-4-复制一个新-redis-实例"}},[r._v("2.4 复制一个新 redis 实例")])]),e("li",[e("a",{attrs:{href:"#_2-5-基于-9001-节点复制出其他的节点"}},[r._v("2.5 基于 9001 节点复制出其他的节点")])]),e("li",[e("a",{attrs:{href:"#_2-6-启动-6-个节点"}},[r._v("2.6 启动 6 个节点")])]),e("li",[e("a",{attrs:{href:"#_2-7-安装高版本-ruby"}},[r._v("2.7 安装高版本 ruby")])]),e("li",[e("a",{attrs:{href:"#_2-8-安装集群所需软件"}},[r._v("2.8 安装集群所需软件")])]),e("li",[e("a",{attrs:{href:"#_2-9-启动集群"}},[r._v("2.9 启动集群")])])])]),e("li",[e("a",{attrs:{href:"#_3-验证"}},[r._v("3. 验证")]),e("ul",[e("li",[e("a",{attrs:{href:"#_3-1-一个节点上写"}},[r._v("3.1 一个节点上写")])]),e("li",[e("a",{attrs:{href:"#_3-2-另一个节点上读"}},[r._v("3.2 另一个节点上读")])])])])])]),e("p"),r._v(" "),e("p",[r._v("#安装 redis 集群")]),r._v(" "),e("h2",{attrs:{id:"_1-约定"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-约定"}},[r._v("#")]),r._v(" 1. 约定")]),r._v(" "),e("p",[r._v("操作系统：Ubuntu 16.04.3 LTS")]),r._v(" "),e("h2",{attrs:{id:"_2-安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装"}},[r._v("#")]),r._v(" 2. 安装")]),r._v(" "),e("h3",{attrs:{id:"_2-1-编译安装单机版-redis"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-编译安装单机版-redis"}},[r._v("#")]),r._v(" 2.1 编译安装单机版 redis")]),r._v(" "),e("p",[r._v("tar -zxvf /root/redis-5.0.5.tar.gz -c /root"),e("br"),r._v("\ncd /root/redis-5.0.5"),e("br"),r._v("\nmake -j2 PREFIX=/usr/local/redis install"),e("br"),r._v("\ncp /root/redis-5.0.5/redis.conf /usr/local/redis/")]),r._v(" "),e("h3",{attrs:{id:"_2-2-准备集群目录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-准备集群目录"}},[r._v("#")]),r._v(" 2.2 准备集群目录")]),r._v(" "),e("p",[r._v("mkdir -p /usr/local/redis-cluster/bin"),e("br"),r._v("\nmkdir -p /usr/local/redis-cluster/9001"),e("br"),r._v("\nmkdir -p /usr/local/redis-cluster/9002"),e("br"),r._v("\nmkdir -p /usr/local/redis-cluster/9003"),e("br"),r._v("\nmkdir -p /usr/local/redis-cluster/9004"),e("br"),r._v("\nmkdir -p /usr/local/redis-cluster/9005"),e("br"),r._v("\nmkdir -p /usr/local/redis-cluster/9006")]),r._v(" "),e("h3",{attrs:{id:"_2-3-准备集群可执行文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-准备集群可执行文件"}},[r._v("#")]),r._v(" 2.3 准备集群可执行文件")]),r._v(" "),e("p",[r._v("cp /usr/local/redis/bin/* /usr/local/redis-cluster/bin/"),e("br"),r._v("\ncp /root/redis-5.0.5/src/mkreleasehdr.sh /usr/local/redis-cluster/bin/"),e("br"),r._v("\ncp /root/redis-5.0.5/src/redis-trib.rb /usr/local/redis-cluster/bin/")]),r._v(" "),e("h3",{attrs:{id:"_2-4-复制一个新-redis-实例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-复制一个新-redis-实例"}},[r._v("#")]),r._v(" 2.4 复制一个新 redis 实例")]),r._v(" "),e("p",[r._v("cp -r /usr/local/redis/ /usr/local/redis-cluster/9001/")]),r._v(" "),e("p",[e("strong",[r._v("修改配置文件")])]),r._v(" "),e("p",[r._v("vi /usr/local/redis-cluster/9001/redis.conf")]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[r._v("\x3c!-- 每个节点的端口号 --\x3e\nport 9001\ndaemonize yes\n\x3c!-- 绑定当前机器 IP --\x3e\nbind 172.18.100.177\ndir /usr/local/redis-cluster/9001/data/\n\x3c!-- pid 9001 和 port 要对应 --\x3e\npidfile /var/run/redis_9001.pid\n\x3c!-- 启动集群模式 --\x3e\ncluster-enabled yes\n\x3c!-- 9001 和 port 要对应 --\x3e\ncluster-config-file nodes-9001.conf\ncluster-node-timeout 15000\nappendonly yes\n")])])]),e("p",[e("strong",[r._v("创建数据目录")]),e("br"),r._v("\nmkdir /usr/local/redis-cluster/9001/data")]),r._v(" "),e("h3",{attrs:{id:"_2-5-基于-9001-节点复制出其他的节点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-基于-9001-节点复制出其他的节点"}},[r._v("#")]),r._v(" 2.5 基于 9001 节点复制出其他的节点")]),r._v(" "),e("p",[r._v("cp -r /usr/local/redis-cluster/9001/* /usr/local/redis-cluster/9002/"),e("br"),r._v("\ncp -r /usr/local/redis-cluster/9001/* /usr/local/redis-cluster/9003/"),e("br"),r._v("\ncp -r /usr/local/redis-cluster/9001/* /usr/local/redis-cluster/9004/"),e("br"),r._v("\ncp -r /usr/local/redis-cluster/9001/* /usr/local/redis-cluster/9005/"),e("br"),r._v("\ncp -r /usr/local/redis-cluster/9001/* /usr/local/redis-cluster/9006/")]),r._v(" "),e("p",[r._v("sed -i 's/9001/9002/g' /usr/local/redis-cluster/9002/redis.conf"),e("br"),r._v("\nsed -i 's/9001/9003/g' /usr/local/redis-cluster/9003/redis.conf"),e("br"),r._v("\nsed -i 's/9001/9004/g' /usr/local/redis-cluster/9004/redis.conf"),e("br"),r._v("\nsed -i 's/9001/9005/g' /usr/local/redis-cluster/9005/redis.conf"),e("br"),r._v("\nsed -i 's/9001/9006/g' /usr/local/redis-cluster/9006/redis.conf")]),r._v(" "),e("h3",{attrs:{id:"_2-6-启动-6-个节点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-启动-6-个节点"}},[r._v("#")]),r._v(" 2.6 启动 6 个节点")]),r._v(" "),e("p",[r._v("vi /usr/local/redis-cluster/bin/start-redis-cluster.sh")]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[r._v("#!/bin/bash\n/usr/local/redis-cluster/bin/redis-server /usr/local/redis-cluster/9001/redis.conf\n/usr/local/redis-cluster/bin/redis-server /usr/local/redis-cluster/9002/redis.conf\n/usr/local/redis-cluster/bin/redis-server /usr/local/redis-cluster/9003/redis.conf\n/usr/local/redis-cluster/bin/redis-server /usr/local/redis-cluster/9004/redis.conf\n/usr/local/redis-cluster/bin/redis-server /usr/local/redis-cluster/9005/redis.conf\n/usr/local/redis-cluster/bin/redis-server /usr/local/redis-cluster/9006/redis.conf\n")])])]),e("p",[r._v("chmod +x /usr/local/redis-cluster/bin/start-redis-cluster.sh"),e("br"),r._v("\n/usr/local/redis-cluster/bin/start-redis-cluster.sh")]),r._v(" "),e("h3",{attrs:{id:"_2-7-安装高版本-ruby"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-7-安装高版本-ruby"}},[r._v("#")]),r._v(" 2.7 安装高版本 ruby")]),r._v(" "),e("p",[r._v("yum install -y centos-release-scl-rh"),e("br"),r._v("\nyum install -y rh-ruby24"),e("br"),r._v("\nscl enable rh-ruby24 bash")]),r._v(" "),e("h3",{attrs:{id:"_2-8-安装集群所需软件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-8-安装集群所需软件"}},[r._v("#")]),r._v(" 2.8 安装集群所需软件")]),r._v(" "),e("p",[r._v("gem sources --add https://gems.ruby-china.com/ --remove https://rubygems.org/"),e("br"),r._v("\nsudo gem install redis (依赖版本 ruby>=2.3.0)")]),r._v(" "),e("h3",{attrs:{id:"_2-9-启动集群"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-9-启动集群"}},[r._v("#")]),r._v(" 2.9 启动集群")]),r._v(" "),e("p",[r._v("/usr/local/redis-cluster/bin/redis-cli --cluster create 172.18.100.177:9001 172.18.100.177:9002 172.18.100.177:9003 172.18.100.177:9004 172.18.100.177:9005 172.18.100.177:9006 --cluster-replicas 1")]),r._v(" "),e("h2",{attrs:{id:"_3-验证"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-验证"}},[r._v("#")]),r._v(" 3. 验证")]),r._v(" "),e("h3",{attrs:{id:"_3-1-一个节点上写"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-一个节点上写"}},[r._v("#")]),r._v(" 3.1 一个节点上写")]),r._v(" "),e("p",[r._v("/usr/local/redis-cluster/bin/redis-cli -h 172.18.100.177 -p 9001 -c")]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[r._v("set key1 val1\nexit\n")])])]),e("h3",{attrs:{id:"_3-2-另一个节点上读"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-另一个节点上读"}},[r._v("#")]),r._v(" 3.2 另一个节点上读")]),r._v(" "),e("p",[r._v("/usr/local/redis-cluster/bin/redis-cli -h 172.18.100.177 -p 9002 -c")]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[r._v("get key1\n")])])])])}),[],!1,null,null,null);s.default=a.exports}}]);