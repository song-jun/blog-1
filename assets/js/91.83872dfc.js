(window.webpackJsonp=window.webpackJsonp||[]).push([[91],{587:function(a,t,s){"use strict";s.r(t);var e=s(26),r=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#安装-elk"}},[a._v("安装 elk")]),s("ul",[s("li",[s("a",{attrs:{href:"#_1-约定"}},[a._v("1. 约定")])]),s("li",[s("a",{attrs:{href:"#_2-准备资源"}},[a._v("2. 准备资源")])]),s("li",[s("a",{attrs:{href:"#_3-安装"}},[a._v("3. 安装")]),s("ul",[s("li",[s("a",{attrs:{href:"#_3-1-安装前准备操作"}},[a._v("3.1 安装前准备操作")])]),s("li",[s("a",{attrs:{href:"#_3-2-安装-elasticsearch"}},[a._v("3.2 安装 elasticsearch")])]),s("li",[s("a",{attrs:{href:"#_3-3-安装-logstash"}},[a._v("3.3 安装 logstash")])]),s("li",[s("a",{attrs:{href:"#_3-4-安装-kibana"}},[a._v("3.4 安装 kibana")])]),s("li",[s("a",{attrs:{href:"#_3-5-安装-elasticsearch-head"}},[a._v("3.5 安装 elasticsearch-head")])])])]),s("li",[s("a",{attrs:{href:"#_4-安装验证"}},[a._v("4. 安装验证")]),s("ul",[s("li",[s("a",{attrs:{href:"#_4-1-验证-elastic"}},[a._v("4.1 验证 elastic")])]),s("li",[s("a",{attrs:{href:"#_4-2-验证-kibana"}},[a._v("4.2 验证 kibana")])])])]),s("li",[s("a",{attrs:{href:"#_5-备注"}},[a._v("5. 备注")]),s("ul",[s("li",[s("a",{attrs:{href:"#_5-1-配置自定义词典"}},[a._v("5.1 配置自定义词典")]),s("ul",[s("li",[s("a",{attrs:{href:"#_5-1-1-将自定义词典文件放到-web-服务"}},[a._v("5.1.1 将自定义词典文件放到 web 服务")])]),s("li",[s("a",{attrs:{href:"#_5-1-2-配置-elasticsearch"}},[a._v("5.1.2 配置 elasticsearch")])]),s("li",[s("a",{attrs:{href:"#_5-1-3-重启-elasticsearch"}},[a._v("5.1.3 重启 elasticsearch")])])])])])])])])])]),s("p"),a._v(" "),s("h1",{attrs:{id:"安装-elk"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-elk"}},[a._v("#")]),a._v(" 安装 elk")]),a._v(" "),s("h2",{attrs:{id:"_1-约定"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-约定"}},[a._v("#")]),a._v(" 1. 约定")]),a._v(" "),s("p",[a._v("操作系统：Ubuntu 16.04.3 LTS")]),a._v(" "),s("h2",{attrs:{id:"_2-准备资源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-准备资源"}},[a._v("#")]),a._v(" 2. 准备资源")]),a._v(" "),s("p",[a._v("jdk-8u144-linux-x64.tar.gz"),s("br"),a._v("\nelasticsearch-6.1.1.tar.gz"),s("br"),a._v("\nlogstash-6.1.1.tar.gz"),s("br"),a._v("\nkibana-6.1.1-linux-x86_64.tar.gz"),s("br"),a._v("\nmysql-connector-java-5.1.41.jar")]),a._v(" "),s("h2",{attrs:{id:"_3-安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装"}},[a._v("#")]),a._v(" 3. 安装")]),a._v(" "),s("h3",{attrs:{id:"_3-1-安装前准备操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-安装前准备操作"}},[a._v("#")]),a._v(" 3.1 安装前准备操作")]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("注意")]),a._v(" "),s("p",[a._v("所有安装操作都在 docker 内执行")])]),a._v(" "),s("ul",[s("li",[s("p",[a._v("创建容器环境\ndocker run -itd --privileged --name elk-ubuntu -p 9100:9100 -p 9200:9200 -p 9300:9300 -p 5601:5601 ubuntu:16.04"),s("br"),a._v("\ndocker cp /data/programInstaller/elasticsearch-6.1.1.tar.gz 28:/root/"),s("br"),a._v("\ndocker cp /data/programInstaller/jdk-8u144-linux-x64.tar.gz 28:/root/"),s("br"),a._v("\ndocker cp /data/programInstaller/kibana-6.1.1-linux-x86_64.tar.gz 28:/root/"),s("br"),a._v("\ndocker cp /data/programInstaller/logstash-6.1.1.tar.gz 28:/root/"),s("br"),a._v("\ndocker cp /data/programInstaller/mysql-connector-java/5.1.41/mysql-connector-java-5.1.41.jar 28:/root/"),s("br"),a._v("\ndocker exec -it 28 bash"),s("br"),a._v("\napt-get update"),s("br"),a._v("\napt-get install vim curl net-tools -y")])]),a._v(" "),s("li",[s("p",[a._v("优化配置\nvi /etc/security/limits.conf")])])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("- soft nofile 65536\n- hard nofile 131072\n- soft nproc 2048\n- hard nproc 4096\n")])])]),s("p",[a._v("vi /etc/security/limits.d/90-nproc.conf")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("-          soft    nproc     4096\n  root soft nproc unlimited\n")])])]),s("p",[a._v("vi /etc/sysctl.conf")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("vm.max_map_count=262144\n")])])]),s("p",[a._v("sysctl -p")]),a._v(" "),s("p",[a._v("cd /root"),s("br"),a._v("\ntar -zxvf /root/jdk-8u144-linux-x64.tar.gz -C /usr/local/"),s("br"),a._v("\nvi /etc/profile.d/jdk.sh")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("#java\nexport JAVA_HOME=/usr/local/jdk1.8.0_144\nexport PATH=$JAVA_HOME/bin:$PATH\nexport CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar\n")])])]),s("p",[a._v("source /etc/profile")]),a._v(" "),s("p",[a._v("tar -zxvf /root/elasticsearch-6.1.1.tar.gz -C /usr/local/"),s("br"),a._v("\ntar -zxvf /root/kibana-6.1.1-linux-x86_64.tar.gz -C /usr/local/"),s("br"),a._v("\ntar -zxvf /root/logstash-6.1.1.tar.gz -C /usr/local/"),s("br"),a._v("\ncp /root/mysql-connector-java-5.1.41.jar /usr/local/logstash-6.1.1/"),s("br"),a._v("\ngroupadd elkusergroup"),s("br"),a._v("\nuseradd elkuser -g elkusergroup -m"),s("br"),a._v("\nchown -R elkuser:elkusergroup /usr/local/elasticsearch-6.1.1/"),s("br"),a._v("\nchown -R elkuser:elkusergroup /usr/local/kibana-6.1.1-linux-x86_64/"),s("br"),a._v("\nchown -R elkuser:elkusergroup /usr/local/logstash-6.1.1/"),s("br"),a._v("\nsu elkuser")]),a._v(" "),s("h3",{attrs:{id:"_3-2-安装-elasticsearch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-安装-elasticsearch"}},[a._v("#")]),a._v(" 3.2 安装 elasticsearch")]),a._v(" "),s("p",[a._v("/usr/local/elasticsearch-6.1.1/bin/elasticsearch-plugin install x-pack"),s("br"),a._v("\n/usr/local/elasticsearch-6.1.1/bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.1.1/elasticsearch-analysis-ik-6.1.1.zip"),s("br"),a._v("\nvi /usr/local/elasticsearch-6.1.1/config/elasticsearch.yml")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("network.host: 0.0.0.0\ncluster.name: my-elastic-cluster1\nnode.name: elastic-node-1 #如果禁用安全组件，那么就没有了用户管理功能;如果要集成 logstash，那么暂时先做如下配置才能对接成功，否则可能需要做 ssl 相关配置才行 #如果没有安装 x-pack，则不需要如下配置\nxpack.security.enabled: false\n")])])]),s("p",[a._v("vi /usr/local/elasticsearch-6.1.1/config/jvm.options")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("-Xms3g\n-Xmx3g\n")])])]),s("p",[a._v("/usr/local/elasticsearch-6.1.1/bin/elasticsearch --verbose -d")]),a._v(" "),s("p",[s("strong",[a._v("设置 elastic，kibana,logstash_system 的密码[约定都设置为 123456].用户名分别为 elastic,kibana,logstash_system #如果没有安装 x-pack，则不需要如下设置密码操作")]),s("br"),a._v("\n/usr/local/elasticsearch-6.1.1/bin/x-pack/setup-passwords interactive")]),a._v(" "),s("h3",{attrs:{id:"_3-3-安装-logstash"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-安装-logstash"}},[a._v("#")]),a._v(" 3.3 安装 logstash")]),a._v(" "),s("p",[a._v("/usr/local/logstash-6.1.1/bin/logstash-plugin install x-pack")]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("注意")]),a._v(" "),s("p",[a._v("需要确保源数据库的表中含有 update_time 字段")])]),a._v(" "),s("p",[a._v("vi /usr/local/logstash-6.1.1/config/logstash.conf")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('input {\nstdin {\n}\njdbc {\njdbc_connection_string => "jdbc:mysql://172.16.38.73:3306/beauty2"\njdbc_user => "root"\njdbc_password => "123456"\njdbc_driver_library => "/usr/local/logstash-6.1.1/mysql-connector-java-5.1.41.jar"\njdbc_driver_class => "com.mysql.jdbc.Driver"\njdbc_paging_enabled => "true"\njdbc_page_size => "50000"\n\nstatement_filepath => "/usr/local/logstash-6.1.1/jdbc.sql"\nuse_column_value => "true"\ntracking_column => "update_time"\nschedule => "\\* \\* \\* \\* \\*"\n}\n}\n\noutput {\nelasticsearch {\nhosts => ["http://localhost:9200"]\n\n       index => "beauty2"\n       document_type => "gallery"\n       document_id => "%{id}"\n\n       template => "/usr/local/logstash-6.1.1/template/logstash.json"\n       template_overwrite => true\n    }\n    stdout{\n       codec=>json_lines\n    }\n\n}\n')])])]),s("p",[a._v("vi /usr/local/logstash-6.1.1/jdbc.sql")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("SELECT \\* FROM sys_gallery where update_time > :sql_last_value\n")])])]),s("p",[a._v("mkdir /usr/local/logstash-6.1.1/template"),s("br"),a._v("\nvi /usr/local/logstash-6.1.1/template/logstash.json")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('{\n"template": "_",\n"version": 60001,\n"settings": {\n"index": {\n"refresh*interval": "5s"\n}\n},\n"mappings": {\n"\\_default*": {\n"dynamic_templates": [\n{\n"message_field": {\n"path_match": "message",\n"match_mapping_type": "string",\n"mapping": {\n"type": "text",\n"norms": false,\n"analyzer": "ik_max_word",\n"search_analyzer": "ik_smart"\n}\n}\n},\n{\n"string_fields": {\n"match": "_",\n"match_mapping_type": "string",\n"mapping": {\n"type": "text",\n"norms": false,\n"analyzer": "ik_max_word",\n"search_analyzer": "ik_smart",\n"fields": {\n"keyword": {\n"type": "keyword",\n"ignore_above": 256\n}\n}\n}\n}\n}\n],\n"properties": {\n"@timestamp": {\n"type": "date"\n},\n"@version": {\n"type": "keyword"\n},\n"geoip": {\n"dynamic": true,\n"properties": {\n"ip": {\n"type": "ip"\n},\n"location": {\n"type": "geo_point"\n},\n"latitude": {\n"type": "half_float"\n},\n"longitude": {\n"type": "half_float"\n}\n}\n}\n}\n}\n},\n"aliases": {}\n}\n')])])]),s("p",[a._v("/usr/local/logstash-6.1.1/bin/logstash -f /usr/local/logstash-6.1.1/config/logstash.conf")]),a._v(" "),s("h3",{attrs:{id:"_3-4-安装-kibana"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-安装-kibana"}},[a._v("#")]),a._v(" 3.4 安装 kibana")]),a._v(" "),s("p",[a._v("/usr/local/kibana-6.1.1-linux-x86_64/bin/kibana-plugin install x-pack"),s("br"),a._v("\nvi /usr/local/kibana-6.1.1-linux-x86_64/config/kibana.yml")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('server.host: "0.0.0.0"\nelasticsearch.url: "http://localhost:9200"\n\n#如果没有安装 x-pack，则不需要如下 2 行配置\nelasticsearch.username: "elastic"\nelasticsearch.password: "123456"\n')])])]),s("p",[a._v("nohup /usr/local/kibana-6.1.1-linux-x86_64/bin/kibana >/usr/local/kibana-6.1.1-linux-x86_64/log 2>&1 &")]),a._v(" "),s("h3",{attrs:{id:"_3-5-安装-elasticsearch-head"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-安装-elasticsearch-head"}},[a._v("#")]),a._v(" 3.5 安装 elasticsearch-head")]),a._v(" "),s("p",[a._v("可以安装独立的 head 服务[默认端口 9100],也可以改用 chrome 浏览器的 elasticsearch-head 插件")]),a._v(" "),s("h2",{attrs:{id:"_4-安装验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-安装验证"}},[a._v("#")]),a._v(" 4. 安装验证")]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("注意")]),a._v(" "),s("p",[a._v("可在宿主机操作")])]),a._v(" "),s("h3",{attrs:{id:"_4-1-验证-elastic"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-验证-elastic"}},[a._v("#")]),a._v(" 4.1 验证 elastic")]),a._v(" "),s("p",[a._v("浏览器访问:http://localhost:9200/?pretty")]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("账号密码(安装步骤中已设置)：elastic/123456")])]),a._v(" "),s("h3",{attrs:{id:"_4-2-验证-kibana"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-验证-kibana"}},[a._v("#")]),a._v(" 4.2 验证 kibana")]),a._v(" "),s("p",[a._v("浏览器访问:http://localhost:5601")]),a._v(" "),s("p",[a._v("账号密码(安装步骤中已设置)：kibana/123456")]),a._v(" "),s("h2",{attrs:{id:"_5-备注"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-备注"}},[a._v("#")]),a._v(" 5. 备注")]),a._v(" "),s("h3",{attrs:{id:"_5-1-配置自定义词典"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-配置自定义词典"}},[a._v("#")]),a._v(" 5.1 配置自定义词典")]),a._v(" "),s("h4",{attrs:{id:"_5-1-1-将自定义词典文件放到-web-服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-1-将自定义词典文件放到-web-服务"}},[a._v("#")]),a._v(" 5.1.1 将自定义词典文件放到 web 服务")]),a._v(" "),s("p",[a._v("例如访问路径http://172.16.38.73:8081/meitu_ik_custom.dic"),s("br"),a._v("\n文件格式如下(要求 utf8 编码)")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("美臀\n爆乳\n")])])]),s("h4",{attrs:{id:"_5-1-2-配置-elasticsearch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-2-配置-elasticsearch"}},[a._v("#")]),a._v(" 5.1.2 配置 elasticsearch")]),a._v(" "),s("p",[a._v("vi /usr/local/elasticsearch-6.1.1/config/analysis-ik/IKAnalyzer.cfg.xml")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('\x3c!-- 指定远程扩展字典服务 --\x3e\n<entry key="remote_ext_dict">http://172.16.38.73:8081/meitu_ik_custom.dic</entry>\n')])])]),s("h4",{attrs:{id:"_5-1-3-重启-elasticsearch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-3-重启-elasticsearch"}},[a._v("#")]),a._v(" 5.1.3 重启 elasticsearch")]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("注意")]),a._v(" "),s("p",[a._v("若想对历史文档应用自定义词典,则需要重新导入历史文档")])])])}),[],!1,null,null,null);t.default=r.exports}}]);