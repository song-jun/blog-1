(window.webpackJsonp=window.webpackJsonp||[]).push([[110],{606:function(a,t,s){"use strict";s.r(t);var r=s(26),e=Object(r.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"安装-sonar-代码质量管理平台"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-sonar-代码质量管理平台"}},[a._v("#")]),a._v(" 安装 sonar 代码质量管理平台")]),a._v(" "),s("h2",{attrs:{id:"一、-约定"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、-约定"}},[a._v("#")]),a._v(" 一、 约定")]),a._v(" "),s("p",[a._v("CentOS-7-x86_64-Minimal-1503-01\nsonar IP：10.96.15.244")]),a._v(" "),s("h2",{attrs:{id:"二、-准备资源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、-准备资源"}},[a._v("#")]),a._v(" 二、 准备资源")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("名称")]),a._v(" "),s("th",[a._v("服务器路径")]),a._v(" "),s("th",[a._v("获取地址")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("jdk")]),a._v(" "),s("td",[a._v("/root/jdk-8u77-linux-x64.rpm")]),a._v(" "),s("td")]),a._v(" "),s("tr",[s("td",[a._v("sonarqube")]),a._v(" "),s("td",[a._v("/root/sonarqube-6.5.zip")]),a._v(" "),s("td",[a._v("https://sonarsource.bintray.com/Distribution/sonarqube/sonarqube-6.5.zip")])])])]),a._v(" "),s("h2",{attrs:{id:"三、-安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、-安装"}},[a._v("#")]),a._v(" 三、 安装")]),a._v(" "),s("h3",{attrs:{id:"_1-安装-jdk"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装-jdk"}},[a._v("#")]),a._v(" 1. 安装 jdk")]),a._v(" "),s("p",[a._v("rpm -ivh /root/jdk-8u77-linux-x64.rpm")]),a._v(" "),s("h3",{attrs:{id:"_2-安装数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装数据库"}},[a._v("#")]),a._v(" 2. 安装数据库")]),a._v(" "),s("p",[a._v("//mysql server 要求必须 5.6 以上"),s("br"),a._v("\nvi /etc/yum.repos.d/MariaDB.repo")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# MariaDB 10.2 CentOS repository list - created 2017-08-11 02:00 UTC\n# http://downloads.mariadb.org/mariadb/repositories/\n[mariadb]\nname = MariaDB\nbaseurl = http://yum.mariadb.org/10.2/centos7-amd64\ngpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB\ngpgcheck=1\n")])])]),s("p",[a._v("yum install MariaDB-server MariaDB-client -y")]),a._v(" "),s("p",[a._v("systemctl start mariadb"),s("br"),a._v('\nmysql -uroot -p -e "create database '),s("strong",[a._v("sonar")]),a._v("; grant all on "),s("em",[a._v(".")]),a._v(" to "),s("strong",[a._v("root")]),a._v("@'localhost' IDENTIFIED by '"),s("strong",[a._v("123456")]),a._v("';\"")]),a._v(" "),s("h3",{attrs:{id:"_3-安装-sonar"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装-sonar"}},[a._v("#")]),a._v(" 3. 安装 sonar")]),a._v(" "),s("p",[a._v("yum install unzip -y"),s("br"),a._v("\nunzip /root/sonarqube-6.5.zip -d /root"),s("br"),a._v('\nsed -i "s/#sonar.web.port=9000/sonar.web.port='),s("strong",[a._v("80")]),a._v('/g" '),s("strong",[a._v("/root/sonarqube-6.5")]),a._v("/conf/sonar.properties"),s("br"),a._v('\nsed -i "s/#sonar.jdbc.username=/sonar.jdbc.username='),s("strong",[a._v("root")]),a._v('/g" '),s("strong",[a._v("/root/sonarqube-6.5")]),a._v("/conf/sonar.properties"),s("br"),a._v('\nsed -i "s/#sonar.jdbc.password=/sonar.jdbc.password='),s("strong",[a._v("123456")]),a._v('/g" '),s("strong",[a._v("/root/sonarqube-6.5")]),a._v("/conf/sonar.properties"),s("br"),a._v('\nsed -i "s/#sonar.jdbc.url=jdbc:mysql/sonar.jdbc.url=jdbc:mysql/g" '),s("strong",[a._v("/root/sonarqube-6.5")]),a._v("/conf/sonar.properties")]),a._v(" "),s("h3",{attrs:{id:"_4-配置防火墙"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-配置防火墙"}},[a._v("#")]),a._v(" 4. 配置防火墙")]),a._v(" "),s("p",[a._v("firewall-cmd --add-port 80/tcp --permanent"),s("br"),a._v("\nfirewall-cmd --reload")]),a._v(" "),s("h2",{attrs:{id:"四、-运行服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、-运行服务"}},[a._v("#")]),a._v(" 四、 运行服务")]),a._v(" "),s("p",[a._v("有 3 种方式")]),a._v(" "),s("h3",{attrs:{id:"_1-原始方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-原始方式"}},[a._v("#")]),a._v(" 1. 原始方式")]),a._v(" "),s("p",[a._v("/root/sonarqube-6.5/bin/linux-x86-64/sonar.sh start"),s("br"),a._v(" "),s("img",{attrs:{src:"https://gitee.com/wangshibiao/blog_picBed2/raw/master/images/20200730100125.png",alt:""}})]),a._v(" "),s("h3",{attrs:{id:"_2-通过-init-d"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-通过-init-d"}},[a._v("#")]),a._v(" 2. 通过 init.d")]),a._v(" "),s("p",[a._v("vi /etc/init.d/sonar")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("#!/bin/sh\n#\n# rc file for SonarQube\n#\n# chkconfig: 345 96 10\n# description: SonarQube system (www.sonarsource.org)\n#\n### BEGIN INIT INFO\n# Provides: sonar\n# Required-Start: $network\n# Required-Stop: $network\n# Default-Start: 3 4 5\n# Default-Stop: 0 1 2 6\n# Short-Description: SonarQube system (www.sonarsource.org)\n# Description: SonarQube system (www.sonarsource.org)\n### END INIT INFO\n\n/usr/bin/sonar $*\n")])])]),s("p",[a._v("ln -s /root/sonarqube-6.5/bin/linux-x86-64/sonar.sh /usr/bin/sonar"),s("br"),a._v("\nchmod +x /etc/init.d/sonar"),s("br"),a._v("\nchkconfig --add sonar"),s("br"),a._v("\nservice sonar start")]),a._v(" "),s("h3",{attrs:{id:"_3-通过-systemd"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-通过-systemd"}},[a._v("#")]),a._v(" 3. 通过 systemd")]),a._v(" "),s("p",[a._v("vi /etc/systemd/system/sonar.service")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[Unit]\nDescription=sonar service\nAfter=network.target\n\n[Service]\nType=forking\nExecStart=/root/sonarqube-6.5/bin/linux-x86-64/sonar.sh start\nExecStop=/root/sonarqube-6.5/bin/linux-x86-64/sonar.sh stop\nUser=root\nRestart=on-abort\n\n[Install]\nWantedBy=multi-user.target\n")])])]),s("p",[a._v("systemctl enable sonar"),s("br"),a._v("\nsystemctl start sonar")]),a._v(" "),s("h2",{attrs:{id:"五、-查看日志"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五、-查看日志"}},[a._v("#")]),a._v(" 五、 查看日志")]),a._v(" "),s("p",[a._v("tail -f /root/sonarqube-6.5/logs/*"),s("br"),a._v(" "),s("img",{attrs:{src:"https://gitee.com/wangshibiao/blog_picBed2/raw/master/images/20200730100454.png",alt:""}})]),a._v(" "),s("h2",{attrs:{id:"六、-验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#六、-验证"}},[a._v("#")]),a._v(" 六、 验证")]),a._v(" "),s("h3",{attrs:{id:"_1-访问http-10-96-15-244"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-访问http-10-96-15-244"}},[a._v("#")]),a._v(" 1. 访问http://10.96.15.244")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/wangshibiao/blog_picBed2/raw/master/images/20200730100535.png",alt:""}})]),a._v(" "),s("h3",{attrs:{id:"_2-登录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-登录"}},[a._v("#")]),a._v(" 2. 登录")]),a._v(" "),s("p",[a._v("账号：admin"),s("br"),a._v("\n密码：admin"),s("br"),a._v(" "),s("img",{attrs:{src:"https://gitee.com/wangshibiao/blog_picBed2/raw/master/images/20200730100626.png",alt:""}})]),a._v(" "),s("h3",{attrs:{id:"_3-推送工程分析报告到服务端-通过命令行工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-推送工程分析报告到服务端-通过命令行工具"}},[a._v("#")]),a._v(" 3. 推送工程分析报告到服务端(通过命令行工具)")]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("约定：\n工程根目录: F:\\workspace\\github\\gradleProjects\\springboot-mybatisDemo(为多模块类型的工程)")])]),a._v(" "),s("h4",{attrs:{id:"_1）下载-sonar-scanner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1）下载-sonar-scanner"}},[a._v("#")]),a._v(" 1）下载 sonar-scanner")]),a._v(" "),s("p",[a._v("下载 sonar-scanner 到 D:\\sonar-scanner-3.0.3.778-windows"),s("br"),a._v(" "),s("img",{attrs:{src:"https://gitee.com/wangshibiao/blog_picBed2/raw/master/images/20200730100837.png",alt:""}})]),a._v(" "),s("h4",{attrs:{id:"_2-配置-sonar-scanner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置-sonar-scanner"}},[a._v("#")]),a._v(" 2) 配置 sonar-scanner")]),a._v(" "),s("p",[a._v("1> 编辑 D:\\sonar-scanner-3.0.3.778-windows\\conf\\sonar-scanner.properties")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("sonar.host.url=http://10.96.15.244\n")])])]),s("p",[s("strong",[a._v("IP 改为实际的 IP")]),s("br"),a._v(" "),s("img",{attrs:{src:"https://gitee.com/wangshibiao/blog_picBed2/raw/master/images/20200730101126.png",alt:""}})]),a._v(" "),s("p",[a._v("2> 工程根目录下创建 sonar scanner 配置文件"),s("br"),a._v("\n创建 "),s("strong",[a._v("F:\\workspace\\github\\gradleProjects\\springboot-mybatisDemo")]),a._v("\\sonar-project.properties:")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# Encoding of the source files\nsonar.sourceEncoding=UTF-8\n# sonarqube中的项目KEY，必须在sonarqube中唯一\nsonar.projectKey=sprintboot-mybatisDemo\n# sonarqube中显示的项目名称及版本号\nsonar.projectName=sprintboot-mybatisDemo\nsonar.projectVersion=1.0\nsonar.java.binaries=../out\n# soanr-project.properties配置相对路径\nsonar.sources=./src/main/java\nsonar.tests=./src/test/java\nsonar.java.coveragePlugin=jacoco\n#配置jacoco的分析结果文件的路径\nsonar.jacoco.reportPaths=../out/build/springboot-mybatisDemo/jacoco/jacocoTest.exec\n")])])]),s("h4",{attrs:{id:"_3-扫描代码并将报告推送到服务端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-扫描代码并将报告推送到服务端"}},[a._v("#")]),a._v(" 3) 扫描代码并将报告推送到服务端")]),a._v(" "),s("p",[a._v("项目根目录执行命令 D:\\sonar-scanner-3.0.3.778-windows\\bin\\sonar-scanner.bat"),s("br"),a._v(" "),s("img",{attrs:{src:"https://gitee.com/wangshibiao/blog_picBed2/raw/master/images/20200730101415.png",alt:""}})]),a._v(" "),s("h3",{attrs:{id:"_4-推送工程分析报告到服务端-通过-gradle-插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-推送工程分析报告到服务端-通过-gradle-插件"}},[a._v("#")]),a._v(" 4. 推送工程分析报告到服务端(通过 gradle 插件)")]),a._v(" "),s("h4",{attrs:{id:"_1-配置-jacoco-插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-配置-jacoco-插件"}},[a._v("#")]),a._v(" 1) 配置 jacoco 插件")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('apply plugin: "jacoco"\n\njacoco {\n    toolVersion = "0.7.6.201602180812"\n    reportsDir = file("$buildDir/customJacocoReportDir")\n}\njacocoTestReport {\n    reports {\n        xml.enabled false\n        csv.enabled false\n        html.destination file("${buildDir}/jacocoHtml")\n    }\n}\ntest {\n    jacoco {\n        append = false\n        destinationFile = file("$buildDir/jacoco/jacocoTest.exec")\n    }\n}\n')])])]),s("h4",{attrs:{id:"_2）-配置-sonarqube-插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2）-配置-sonarqube-插件"}},[a._v("#")]),a._v(" 2） 配置 sonarqube 插件")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('plugins {\n    id "org.sonarqube" version "2.5"\n}\n\nsonarqube {\n    properties {\n        property "sonar.sourceEncoding", "UTF-8"\n    }\n}\n\nsonarqube {\n    properties {\n        property "sonar.sources", "./src/main"\n        property "sonar.tests", "./src/test"\n\n        //sonar.projectName、sonar.projectKey不配置，则会启用默认配置\n        property "sonar.projectName", "sprintboot-mybatisDemo"\n        property "sonar.projectKey", "sprintboot-mybatisDemo"\n       /*无需配置sonar.jacoco.itReportPath，通过测试得知“sonarqube插件会自动检测”\n        property "sonar.jacoco.itReportPath",         "../out/build/sprintboot-mybatisDemo/jacoco/jacocoTest.exec" */\n    }\n}\n')])])]),s("h4",{attrs:{id:"_3-配置-sonar-服务的-ip"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置-sonar-服务的-ip"}},[a._v("#")]),a._v(" 3) 配置 sonar 服务的 IP")]),a._v(" "),s("p",[a._v("创建 F:\\workspace\\github\\gradleProjects\\gradle.properties")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("systemProp.sonar.host.url=http://10.96.15.244\n")])])]),s("p",[s("img",{attrs:{src:"https://gitee.com/wangshibiao/blog_picBed2/raw/master/images/20200730101754.png",alt:""}})]),a._v(" "),s("h4",{attrs:{id:"_4-扫描代码并将报告推送到服务端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-扫描代码并将报告推送到服务端"}},[a._v("#")]),a._v(" 4) 扫描代码并将报告推送到服务端")]),a._v(" "),s("p",[a._v("gradle springboot-mybatisDemo:sonarqube")]),a._v(" "),s("h3",{attrs:{id:"_5-服务端查看分析报告"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-服务端查看分析报告"}},[a._v("#")]),a._v(" 5. 服务端查看分析报告")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/wangshibiao/blog_picBed2/raw/master/images/20200730101852.png",alt:""}})]),a._v(" "),s("h3",{attrs:{id:"_6-客户端从服务端拉取规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-客户端从服务端拉取规则"}},[a._v("#")]),a._v(" 6. 客户端从服务端拉取规则")]),a._v(" "),s("p",[a._v("以 idea IDE 的 SonarLint 插件为例。")]),a._v(" "),s("h4",{attrs:{id:"_1-安装-sonarlint-插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装-sonarlint-插件"}},[a._v("#")]),a._v(" 1) 安装 SonarLint 插件")]),a._v(" "),s("h4",{attrs:{id:"_2-配置-sonarlint-插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置-sonarlint-插件"}},[a._v("#")]),a._v(" 2) 配置 SonarLint 插件")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/wangshibiao/blog_picBed2/raw/master/images/20200730102153.png",alt:""}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/wangshibiao/blog_picBed2/raw/master/images/20200730102224.png",alt:""}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/wangshibiao/blog_picBed2/raw/master/images/20200730102246.png",alt:""}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/wangshibiao/blog_picBed2/raw/master/images/20200730102313.png",alt:""}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/wangshibiao/blog_picBed2/raw/master/images/20200730102415.png",alt:""}})])])}),[],!1,null,null,null);t.default=e.exports}}]);