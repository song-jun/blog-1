---
title: vuepress配置谷歌统计
permalink: /vuepress-google-analytics.html
date: 2020-06-15 11:40:45
categories:
  - vuepress
  - 谷歌
  - 用户统计
tags:
  - google
  - 谷歌
  - analytics
  - 谷歌统计
  - 谷歌分析
---

## 获取 谷歌 统计代码

- 登录[谷歌统计后台](https://analytics.google.com)
- 创建站点
- 复制统计代码

![20200603112847.png](https://cdn.jsdelivr.net/gh/wangshibiaoFlytiger/blog_picBed1/images/20200603112847.png)

```
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-168383599-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-168383599-1');
</script>
```

## 配置 谷歌 统计代码

### 终极方案

::: tip
该方案考虑到了路由切换的场景，完美，推荐采用。
:::

- 安装依赖  
  yarn add -D @vuepress/plugin-google-analytics
- 修改配置 config.js

```
module.exports = {
  plugins: [
    [
      '@vuepress/google-analytics',
      {
        'ga': 'UA-00000000-0' //替换成自己实际申请的ID
      }
    ]
  ]
}
```

> 参考[官方文档](https://vuepress.vuejs.org/plugin/official/plugin-google-analytics.html#install)

### 不完美方案

::: tip
不建议采用该方案，网络上可以看到很多教程讲授的就是该方案，本文专门列举出，就是为了让博友引起注意，并给出不推荐使用的理由。
:::

起初采用的该方案，但是有漏洞: 仅首次访问或有页面刷新行为时，才会触发谷歌统计。  
因为 vuepress 是单页面架构, 所以切换路由(即切换页面)的时候，并不会有页面刷新动作，导致谷歌统计代码不会执行，进而会漏掉上报行为。  
vi ./config.js

```
head: [
    /*************** start 添加谷歌统计 ***********/
    [
      "script",
      {
        src: "https://www.googletagmanager.com/gtag/js?id=UA-168383599-1",
        async: true
      }
    ],
    [
      "script",
      {},
      `
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-168383599-1');
      `
    ],
    /*************** end 添加谷歌统计 ***********/
  ]
```

## 验证

### 通过 Chrome 开发者工具过滤请求

查看是否有谷歌统计的请求, 会发车 2 个请求(analytics.js 和 collect)  
![20200615104149.png](https://cdn.jsdelivr.net/gh/wangshibiaoFlytiger/blog_picBed1/images/20200615104149.png)

### 通过 chrome 插件 Tag Assistant

该插件提供如下功能

- 检查 GA 代码（包括 Classic Google Analytics 和 Universal Analytics）
- 检查 GTM 代码
- 检查其他 Google 营销相关代码
