---
title: linux安装本地docker仓库
permalink: /linux-install-docker-repository.html
date: 2020-07-13 11:20:11
categories:
  - 运维
  - docker
tags:
  - 运维
  - docker
  - 仓库
---

# linux 安装本地 docker 仓库

::: tip
10.96.15.244 为本机 IP，具体操作需要替换为实际 IP。
:::

## 安装镜像服务端

- 修改配置文件  
  vi /etc/docker/daemon.json

```
{
  "insecure-registries": ["10.96.15.244:5000"]
}
```

- 运行容器 registry  
  systemctl restart docker  
  docker pull registry:2  
  docker run -d -p 5000:5000 --restart=always -v /opt/data/registry:/var/lib/registry --name myRegistry registry:2  
  docker ps

- 对本地镜像打 tag  
  ::: tip
  对想要推送的镜像 打 tag。
  :::
  docker tag sonarqube:v4 10.96.15.244:5000/sonarqube:v4
- 推送本地镜像到 docker 仓库  
  docker push 10.96.15.244:5000/sonarqube:v4

- 查看推送结果  
  ll /opt/data/registry/  
  curl -X GET http://10.96.15.244:5000/v2/_catalog  
  curl -X GET http://10.96.15.244:5000/v2/sonarqube/tags/list

## docker 客户端拉取镜像

### 安装客户端

yum install /root/docker-ce-17.06.0.ce-1.el7.centos.x86_64.rpm -y  
vi /etc/docker/daemon.json:

```
{
"registry-mirrors": ["10.96.15.244:5000"],
"insecure-registries": ["10.96.15.244:5000"]
}
```

systemctl start docker

### 拉取镜像

docker pull 10.96.15.244:5000/sonarqube:v4  
docker images  
docker run -itd -p 80:80 -v /root/sonarqube_temp/:/root/sonarqube-6.5/temp/ --name sonarqube_v4 10.96.15.244:5000/sonarqube:v4  
docker ps
